---
layout: post
category : all
tags : [其他]
---
{% include JB/setup %}


键。键是唯一标识一个实体的一个或者多个数据属性。在物理数据库中，键可以由表的一个或者多个列组成，它们的值唯一标识关系表中的一行。
复合键。由两个或者多个属性组成的键。
自然键。由现实世界中已经存在的属性组成的键。例如，美国公民被分配了一个唯一（不保证一定正确，但实际上非常接近唯一）的社会保险号（SSN）。如果隐私法允许的话，SSN可能被用作Person实体的自然键（假设组织的人员范围仅限于美国）。
代理键。不具有业务含义的键。
候选键。在逻辑数据模型中的实体类型可能具有0或多个候选键，简称为唯一标识（注解：某些人不主张在逻辑数据模型中标识候选键，因此没有固定标准）。例如，假设我们只涉及美国公民，那么SSN是Person实体类型的一个候选键，同时姓名与电话号码的组合（假设组合是唯一的）是第二个可能的候选键。这两个键都被称作候选键是因为它们是物理数据模型中主键、次键或者非键的候选目标。
主键。实体类型的首选键。
备用键。也就是次键，是表中行的另一个唯一标识。
外键。在一个实体类型中表示另一个实体类型的主键或者次键的一个或多个属性。



---------
为表指定键的策略有两种：
自然键。自然键是已经存在的一个或多个属性，它在业务概念中是唯一的。对于表Customer来说，存在两个候选键，CustomerNumber与SocialSecurityNumber。
代理键。引入一个不具有业务含义的列作为键，称作代理键。例如图1中表Address的列AddressID。地址不具有一个“简单”的自然键，因为需要使用Address表的所有列组成一个键（取决于你的问题域，可能仅仅需要组合Street和ZipCode列），所以此时引入一个代理键是一个更好的选择。
自然键的优点是它们已经存在，不需要在数据模式中引入一个新的“非自然”列。然而，自然键的缺点是由于具有业务含义，它们与业务直接耦合：你可能在业务需求变更时重新指定键。例如，当你的用户决定将CustomerNumber列从数字型改为字母数字型，除了更新表Customer的模式（这个是不可避免的）外，你还需要修改每一个使用CustomerNumber作为外键的表。
代理键具有几个优点。首先，它们不与业务耦合，因此更容易维护（假设你选择了一个好的实现策略）。例如，如果表Customer改为使用代理键，修改只需要在表Customer内部进行（此时CustomerNumber只是表的一个非键列）。当然，如果你需要针对代理键策略做相似的变更，可能是由于用完了所有的值而需要增加几个位数，将会面临同样的问题。其次，一个大多数表，最好是全部表，通用的键策略能够减少需要编写的源码数量，减少系统的总体拥有成本（TCO）。代理键根本的缺点是它们通常不是“人可读的”，导致终端用户难以使用。这意味着你可能仍然需要实现代理键用于查找、编辑等等。
根本问题在于键是关系模式中重要的耦合源，因此它们很难更改。这意味着你通常想要避免具有业务含义的键，因为业务含义存在变化。话虽如此，我倾向于使用自然键查找/引用表，尤其当我认为键值在最近不会改变时，如下文所述。从根本上讲，是否应该优先使用自然键没有明确的答案，不管这个宗教之争的另外一方狂热者如何声称，最好的策略是只要有意义就可以使用任何一个策略。

-------
如何有效地选择键？参考以下提示：
避免“智能”键。“智能”键是由一个或多个具有业务含义的部分组成的键。例如，美国邮政编码的前两位表示它所在的州。智能键的第一个问题是它具有业务含义。其次是它们的使用通常随着时间变得很复杂。例如，一些大的州拥有多个代码，加利福尼亚的邮编以90和91开头，导致基于州编码的查询更加复杂。第三个问题是它们通常增加了策略需要进行扩展的可能性。考虑长度为9位数字的邮编（后4位数字由建筑所有者自行决定，建筑由邮编唯一标识），在用完2位州代码前用完9位数字的可能性更小。
考虑为简单的“查找”表指定自然键。“查找”表是用于关联代码与详细信息的表。例如，你可能拥有一个列出了颜色代码对应颜色名称的查找表。例如，代码127代表“郁金香黄色”。简单的查找表通常包含一个代码列和一个描述/名称列，而复杂的查找表包含一个代码列和几个信息列。
自然键并非总是适用于“查找”表。另一个例子是一个查找表包含北美洲的州、省或者地区。例如美国的加利福尼亚州以及加拿大的安大略省。该表的主要目的是为这些地理位置提供一个正式的列表，它不会随时间变化（最近一次变化是90年代后期，加拿大的西北地区分割为努勒维特和西北地区）。该表的一个有效自然键可以是州代码，一个值唯一的两字符代码--例如加利福尼亚的CA以及安大略的ON。不幸的是这种方法并不适合，因为加拿大政府决定为西北地区两个州使用相同的代码NW。
应用必须仍然支持“自然键搜索”。如果选择采用代理键，必须不能忘了应用需要支持基于地域列（仍然唯一标识数据行）的搜索。例如，Customer表可能拥有一个Customer_POID的代理键，以及一个Customer_Number列和Social_Security_Number列。你很可能需要支持基于顾客编号和社会保险号的搜索。搜索在关系数据库对象检索最佳实践中详细讨论。
不要自然化代理键。一旦你向终端用户显示了代理键的值，或者更坏的是允许他们使用该值（例如搜索该值），实际上你已经给它们赋予了业务含义。这实际上是自然化了代理键从而失去了代理键的优点。
